Index: main_test.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>#!/usr/bin/python\r\n# -*- coding: UTF-8 -*-\r\n\r\n#\r\n#    this is an UART-LoRa device and thers is an firmware on Module\r\n#    users can transfer or receive the data directly by UART and dont\r\n#    need to set parameters like coderate,spread factor,etc.\r\n#    |============================================ |\r\n#    |   It does not suport LoRaWAN protocol !!!   |\r\n#    | ============================================|\r\n#   \r\n#    This script is mainly for Raspberry Pi 3B+, 4B, and Zero series\r\n#    Since PC/Laptop does not have GPIO to control HAT, it should be configured by\r\n#    GUI and while setting the jumpers, \r\n#    Please refer to another script pc_main.py\r\n#\r\n\r\nfrom encodings import utf_8\r\nimport sys\r\nimport sx126x\r\nimport threading\r\nimport time\r\nimport select\r\nimport termios\r\nimport asyncio\r\nimport tty\r\nfrom threading import Timer\r\n\r\nold_settings = termios.tcgetattr(sys.stdin)\r\ntty.setcbreak(sys.stdin.fileno())\r\n\r\n\r\n#####Importing node_id from a seperate folder not including in git, so we can keep pulling without defaulting back to std node_id\r\nsys.path.insert(1, '/home/pi/node_id')\r\nimport node\r\nn_id = node.node.node_id\r\nsys.path.insert(1, '/home/bsc.-projekt/python')\r\n\r\n\r\n#\r\n#    Need to disable the serial login shell and have to enable serial interface \r\n#    command `sudo raspi-config`\r\n#    More details: see https://github.com/MithunHub/LoRa/blob/main/Basic%20Instruction.md\r\n#\r\n#    When the LoRaHAT is attached to RPi, the M0 and M1 jumpers of HAT should be removed.\r\n#\r\n\r\n\r\n#    The following is to obtain the temprature of the RPi CPU \r\ndef get_cpu_temp():\r\n    tempFile = open( \"/sys/class/thermal/thermal_zone0/temp\" )\r\n    cpu_temp = tempFile.read()\r\n    tempFile.close()\r\n    return float(cpu_temp)/1000\r\n\r\n#   serial_num\r\n#       PiZero, Pi3B+, and Pi4B use \"/dev/ttyS0\"\r\n#\r\n#    Frequency is [850 to 930], or [410 to 493] MHz\r\n#\r\n#    address is 0 to 65535\r\n#        under the same frequence,if set 65535,the node can receive \r\n#        messages from another node of address is 0 to 65534 and similarly,\r\n#        the address 0 to 65534 of node can receive messages while \r\n#        the another note of address is 65535 sends.\r\n#        otherwise two node must be same the address and frequence\r\n#\r\n#    The tramsmit power is {10, 13, 17, and 22} dBm\r\n#\r\n#    RSSI (receive signal strength indicator) is {True or False}\r\n#        It will print the RSSI value when it receives each message\r\n#\r\n\r\n# node = sx126x.sx126x(serial_num = \"/dev/ttyS0\",freq=433,addr=0,power=22,rssi=False,air_speed=2400,relay=False)\r\nnode = sx126x.sx126x(serial_num = \"/dev/ttyS0\",freq=868,addr=0,node_id=n_id,power=22,rssi=True,air_speed=2400,relay=False)\r\n\r\ndef send_deal():\r\n    #####Added the second input requirement of node id (also mentioned as 0 in line 72)\r\n    get_rec = \"\"\r\n    print(\"\")\r\n    print(\"input a string such as \\033[1;32m0,0,868,Hello World\\033[0m,it will send `Hello World` to lora node device of address 0 with node id 0 and 868M \")\r\n    print(\"please input and press Enter key:\",end='',flush=True)\r\n\r\n    while True:\r\n        rec = sys.stdin.read(1)\r\n        if rec != None:\r\n            if rec == '\\x0a': break\r\n            get_rec += rec\r\n            sys.stdout.write(rec)\r\n            sys.stdout.flush()\r\n\r\n    get_t = get_rec.split(\",\")\r\n\r\n    offset_frequence = int(get_t[2])-(850 if int(get_t[2])>850 else 410)\r\n    #####Added the node id to the data variable, both in receiving node and own node.\r\n    #####\r\n    # the sending message format\r\n    #\r\n    #         receiving node              receiving node             receiving node           receiving node             own high 8bit            own low 8bit                     \r\n    #         high 8bit address           low 8bit address           node id                  frequency                  address                  address                           node_id      message payload\r\n    data = bytes([int(get_t[0])>>8]) + bytes([int(get_t[0])&0xff]) + bytes([offset_frequence]) + bytes([node.addr>>8]) + bytes([node.addr&0xff]) + bytes([node.offset_freq]) + get_t[1].encode() + str(node.node_id).encode() + get_t[3].encode()\r\n\r\n    node.send(data)\r\n    print('\\x1b[2A',end='\\r')\r\n    print(\" \"*200)\r\n    print(\" \"*200)\r\n    print(\" \"*200)\r\n    print('\\x1b[3A',end='\\r')\r\n\r\ndef send_cpu_continue(continue_or_not = True):\r\n    if continue_or_not:\r\n        global timer_task\r\n        global seconds\r\n        #\r\n        # boarcast the cpu temperature at 868.125MHz\r\n        #\r\n        data = bytes([255]) + bytes([255]) + bytes([18]) + bytes([255]) + bytes([255]) + bytes([12]) + \"CPU Temperature:\".encode()+str(get_cpu_temp()).encode()+\" C\".encode()\r\n        node.send(data)\r\n        time.sleep(0.2)\r\n        timer_task = Timer(seconds,send_cpu_continue)\r\n        timer_task.start()\r\n    else:\r\n        data = bytes([255]) + bytes([255]) + bytes([18]) + bytes([255]) + bytes([255]) + bytes([12]) + \"CPU Temperature:\".encode()+str(get_cpu_temp()).encode()+\" C\".encode()\r\n        node.send(data)\r\n        time.sleep(0.2)\r\n        timer_task.cancel()\r\n        pass\r\n\r\ndef main():\r\n    try:\r\n        time.sleep(1)\r\n        print(\"Press \\033[1;32mEsc\\033[0m to exit\")\r\n        print(\"Press \\033[1;32mi\\033[0m   to send\")\r\n        print(\"Press \\033[1;32ms\\033[0m   to send cpu temperature every 10 seconds\")\r\n\r\n        # it will send rpi cpu temperature every 10 seconds\r\n        seconds = 10\r\n\r\n        while True:\r\n\r\n            if select.select([sys.stdin], [], [], 0) == ([sys.stdin], [], []):\r\n                c = sys.stdin.read(1)\r\n\r\n                # dectect key Esc\r\n                if c == '\\x1b': break\r\n                # dectect key i\r\n                if c == '\\x69':\r\n                    send_deal()\r\n                # dectect key s\r\n                if c == '\\x73':\r\n                    print(\"Press \\033[1;32mc\\033[0m   to exit the send task\")\r\n                    timer_task = Timer(seconds, send_cpu_continue)\r\n                    timer_task.start()\r\n\r\n                    while True:\r\n                        if sys.stdin.read(1) == '\\x63':\r\n                            timer_task.cancel()\r\n                            print('\\x1b[1A', end='\\r')\r\n                            print(\" \" * 100)\r\n                            print('\\x1b[1A', end='\\r')\r\n                            break\r\n\r\n                sys.stdout.flush()\r\n\r\n            node.receive()\r\n\r\n            # timer,send messages automatically\r\n\r\n    except:\r\n        termios.tcsetattr(sys.stdin, termios.TCSADRAIN, old_settings)\r\n        # print('\\x1b[2A',end='\\r')\r\n        # print(\" \"*100)\r\n        # print(\" \"*100)\r\n        # print('\\x1b[2A',end='\\r')\r\n\r\ntermios.tcsetattr(sys.stdin, termios.TCSADRAIN, old_settings)\r\n    # print('\\x1b[2A',end='\\r')\r\n    # print(\" \"*100)\r\n    # print(\" \"*100)\r\n    # print('\\x1b[2A',end='\\r')\r\n\r\nif __name__ == \"__main()__\":\r\n    main()\r\n\r\n#def send_ack():\r\n    #send data with node id, wait for answer, if we get answer, note node_id \r\n #   offset_frequence = int(get_t[2])-(850 if int(get_t[2])>850 else 410)\r\n    #####Added the node id to the data variable, both in receiving node and own node.\r\n    #####\r\n    # the sending message format\r\n    #\r\n    #         receiving node              receiving node             receiving node           receiving node             own high 8bit            own low 8bit              own                own \r\n    #         high 8bit address           low 8bit address           node id                  frequency                  address                  address                   node id            frequency                  \r\n  #  data = bytes([int(get_t[0])>>8]) + bytes([int(get_t[0])&0xff]) + bytes([int(get_t[1])]) + bytes([offset_frequence]) + bytes([node.addr>>8]) + bytes([node.addr&0xff]) + bytes([node.node_id]) + bytes([node.offset_freq])\r\n\r\n## just testing how bracnhing works
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/main_test.py b/main_test.py
--- a/main_test.py	(revision 6b6f4e47c04da1f929f2ce2640bf30f7f04738af)
+++ b/main_test.py	(date 1652014238981)
@@ -173,7 +173,7 @@
         # print(" "*100)
         # print('\x1b[2A',end='\r')
 
-termios.tcsetattr(sys.stdin, termios.TCSADRAIN, old_settings)
+    termios.tcsetattr(sys.stdin, termios.TCSADRAIN, old_settings)
     # print('\x1b[2A',end='\r')
     # print(" "*100)
     # print(" "*100)
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"2ceb3ed1-c329-4488-a36e-371dc362c135\" name=\"Changes\" comment=\"main work pls\" />\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$/..\" />\r\n  </component>\r\n  <component name=\"MarkdownSettingsMigration\">\r\n    <option name=\"stateVersion\" value=\"1\" />\r\n  </component>\r\n  <component name=\"ProjectId\" id=\"28NYxfVQAt18FdGuCDEfGmumfSr\" />\r\n  <component name=\"ProjectLevelVcsManager\" settingsEditedManually=\"true\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">\r\n    <property name=\"RunOnceActivity.OpenProjectViewOnStart\" value=\"true\" />\r\n    <property name=\"RunOnceActivity.ShowReadmeOnStart\" value=\"true\" />\r\n  </component>\r\n  <component name=\"RunManager\">\r\n    <configuration name=\"main_test\" type=\"PythonConfigurationType\" factoryName=\"Python\" temporary=\"true\" nameIsGenerated=\"true\">\r\n      <module name=\"python\" />\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"true\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/main_test.py\" />\r\n      <option name=\"PARAMETERS\" value=\"\" />\r\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\r\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\r\n      <option name=\"MODULE_MODE\" value=\"false\" />\r\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\r\n      <option name=\"INPUT_FILE\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <recent_temporary>\r\n      <list>\r\n        <item itemvalue=\"Python.main_test\" />\r\n      </list>\r\n    </recent_temporary>\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"2ceb3ed1-c329-4488-a36e-371dc362c135\" name=\"Changes\" comment=\"\" />\r\n      <created>1651058759430</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1651058759430</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"test\">\r\n      <created>1651133508410</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651133508410</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"print fix\">\r\n      <created>1651133665590</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651133665590</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"revert\">\r\n      <created>1651133811553</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651133811553</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"hmm\">\r\n      <created>1651134023842</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651134023842</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"hmm\">\r\n      <created>1651134117138</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651134117138</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"str r_buff[2]\">\r\n      <created>1651134227598</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651134227598</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00007\" summary=\"get_t[1]\">\r\n      <created>1651134725507</created>\r\n      <option name=\"number\" value=\"00007\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00007\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651134725507</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00008\" summary=\"bytes([int(get_t[1]))\">\r\n      <created>1651143600183</created>\r\n      <option name=\"number\" value=\"00008\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00008\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651143600183</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00009\" summary=\"bytes([int(get_t[1]))\">\r\n      <created>1651143844639</created>\r\n      <option name=\"number\" value=\"00009\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00009\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651143844639</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00010\" summary=\"bytes(str(get_t[1]))\">\r\n      <created>1651143989993</created>\r\n      <option name=\"number\" value=\"00010\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00010\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651143989993</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00011\" summary=\"if node_id = node_id receive, if node_id=0 broadcast\">\r\n      <created>1651491765028</created>\r\n      <option name=\"number\" value=\"00011\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00011\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1651491765028</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00012\" summary=\"main function wrap\">\r\n      <created>1652010549410</created>\r\n      <option name=\"number\" value=\"00012\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00012\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1652010549410</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00013\" summary=\"restore tty\">\r\n      <created>1652011006755</created>\r\n      <option name=\"number\" value=\"00013\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00013\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1652011006755</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00014\" summary=\"commented out if name = main\">\r\n      <created>1652011103346</created>\r\n      <option name=\"number\" value=\"00014\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00014\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1652011103346</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00015\" summary=\"move node etc. to main()\">\r\n      <created>1652012899746</created>\r\n      <option name=\"number\" value=\"00015\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00015\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1652012899746</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00016\" summary=\"main work pls\">\r\n      <created>1652013994717</created>\r\n      <option name=\"number\" value=\"00016\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00016\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1652013994718</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"17\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State />\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"test\" />\r\n    <MESSAGE value=\"print fix\" />\r\n    <MESSAGE value=\"revert\" />\r\n    <MESSAGE value=\"hmm\" />\r\n    <MESSAGE value=\"str r_buff[2]\" />\r\n    <MESSAGE value=\"get_t[1]\" />\r\n    <MESSAGE value=\"bytes([int(get_t[1]))\" />\r\n    <MESSAGE value=\"bytes(str(get_t[1]))\" />\r\n    <MESSAGE value=\"if node_id = node_id receive, if node_id=0 broadcast\" />\r\n    <MESSAGE value=\"main function wrap\" />\r\n    <MESSAGE value=\"restore tty\" />\r\n    <MESSAGE value=\"commented out if name = main\" />\r\n    <MESSAGE value=\"move node etc. to main()\" />\r\n    <MESSAGE value=\"main work pls\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"main work pls\" />\r\n  </component>\r\n  <component name=\"XDebuggerManager\">\r\n    <breakpoint-manager>\r\n      <default-breakpoints>\r\n        <breakpoint type=\"python-exception\">\r\n          <properties notifyOnTerminate=\"true\" exception=\"BaseException\">\r\n            <option name=\"notifyOnTerminate\" value=\"true\" />\r\n          </properties>\r\n        </breakpoint>\r\n      </default-breakpoints>\r\n    </breakpoint-manager>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 6b6f4e47c04da1f929f2ce2640bf30f7f04738af)
+++ b/.idea/workspace.xml	(date 1652014874656)
@@ -4,7 +4,9 @@
     <option name="autoReloadType" value="SELECTIVE" />
   </component>
   <component name="ChangeListManager">
-    <list default="true" id="2ceb3ed1-c329-4488-a36e-371dc362c135" name="Changes" comment="main work pls" />
+    <list default="true" id="2ceb3ed1-c329-4488-a36e-371dc362c135" name="Changes" comment="main work pls">
+      <change beforePath="$PROJECT_DIR$/main_test.py" beforeDir="false" afterPath="$PROJECT_DIR$/main_test.py" afterDir="false" />
+    </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
     <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
